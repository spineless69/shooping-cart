<!DOCTYPE html>
<html>
<head>
    <title>Shopping Cart</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .product, .cart-item {
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        button { margin-left: 10px; }
        h2 { border-bottom: 1px solid #ccc; padding-bottom: 5px; }
        #cart-total { font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>ðŸ›’ Shopping Cart</h1>

    <h2>Products</h2>
    <div id="product-list"></div>

    <h2>Cart</h2>
    <div id="cart"></div>
    <div id="cart-total"></div>
    <button onclick="clearCart()">Clear Cart</button>

    <script>
        async function loadProducts() {
            const res = await fetch('/products');
            const products = await res.json();
            const list = document.getElementById('product-list');
            list.innerHTML = '';
            products.forEach(p => {
                const div = document.createElement('div');
                div.className = 'product';
                div.innerHTML = `
                    <strong>${p.name}</strong> - $${p.price}
                    <button onclick="addToCart(${p.id})">Add to Cart</button>
                `;
                list.appendChild(div);
            });
        }

        async function loadCart() {
            const res = await fetch('/cart');
            const data = await res.json();
            const cartDiv = document.getElementById('cart');
            const totalDiv = document.getElementById('cart-total');
            cartDiv.innerHTML = '';
            totalDiv.innerHTML = '';
            if (data.items.length === 0) {
                cartDiv.innerHTML = '<i>Your cart is empty.</i>';
                return;
            }
            data.items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'cart-item';
                div.innerHTML = `
                    <strong>${item.name}</strong> - $${item.price} x 
                    <input type="number" value="${item.quantity}" min="0" style="width: 50px"
                        onchange="updateCart(${item.id}, this.value)">
                    = $${item.total}
                `;
                cartDiv.appendChild(div);
            });
            totalDiv.innerHTML = `Total: $${data.total}`;
        }

        async function addToCart(id) {
            await fetch('/cart', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id: id, quantity: 1 })
            });
            loadCart();
        }

        async function updateCart(id, quantity) {
            await fetch('/cart/update', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id: id, quantity: parseInt(quantity) })
            });
            loadCart();
        }

        async function clearCart() {
            await fetch('/cart', { method: 'DELETE' });
            loadCart();
        }

        loadProducts();
        loadCart();
    </script>
</body>
</html>
